function init(){var t=d3.select("svg"),a={top:20,right:20,bottom:30,left:40},e=+t.attr("width")-a.left-a.right,n=+t.attr("height")-a.top-a.bottom,r=d3.scaleBand().rangeRound([0,e]).padding(.1),s=d3.scaleLinear().rangeRound([n,0]),o=t.append("g").attr("transform","translate("+a.left+","+a.top+")");d3.csv("./data/bystate.csv",function(t){if(stateData.push(t),1==t.month&&2016==t.year)return t.percent=+t.percent,t},function(t,a){if(t)throw t;r.domain(a.map(function(t){return t.state})),s.domain([0,Math.max.apply(Math,stateData.map(function(t){return t.percent}))]),o.append("g").attr("class","axis axis--x").attr("transform","translate(0,"+n+")").call(d3.axisBottom(r)),o.append("g").attr("class","axis axis--y").call(d3.axisLeft(s).ticks(10,"%")).append("text").attr("transform","rotate(-90)").attr("y",6).attr("dy","0.71em").attr("text-anchor","end").text("Frequency"),o.selectAll(".bar").data(a).enter().append("rect").attr("class","bar").attr("x",function(t){return r(t.state)}).attr("y",function(t){return s(t.percent)}).attr("width",r.bandwidth()).attr("height",function(t){return n-s(t.percent)}).on("mouseover",function(t){coordinates=d3.mouse(this),d3.select(".relative").style("left",coordinates[0]+"px").style("top",coordinates[1]-60+"px").select("#info").text(tooltipText(t)),d3.select("#tooltip").classed("hidden",!1)}).on("mouseout",function(){d3.select("#tooltip").classed("hidden",!0)})})}function tooltipText(t){return"Média - R$: "+parseFloat(t.mean).toFixed(0)+" Máximo - R$: "+(t.mean/t.percent).toFixed(0)+" Total - R$: "+parseFloat(t.x1).toFixed(0)+" Deputados ("+t.state+"): "+t.people}function update_state_vis(t,a){data=[];for(var e=0;e<stateData.length;e++)stateData[e].month==t&&stateData[e].year==a&&data.push(stateData[e]);d3.selectAll(".bar").data(data);var n=d3.select("svg"),r={top:20,right:20,bottom:30,left:40},s=+n.attr("width")-r.left-r.right,o=+n.attr("height")-r.top-r.bottom,i=(d3.scaleBand().rangeRound([0,s]).padding(.1),d3.scaleLinear().rangeRound([o,0]));i.domain([0,Math.max.apply(Math,stateData.map(function(t){return t.percent}))]);n.selectAll(".bar").attr("stroke-width",4).transition().duration(300).attr("height",function(t){for(var a=0;a<data.length;a++)if(data[a].state==t.state)return o-i(data[a].percent)}).attr("transform",function(t){for(var a=0;a<data.length;a++)if(data[a].state==t.state)return"translate("+[0,-this.y.baseVal.value+i(data[a].percent)]+")"})}$(document).ready(function(){$("select").material_select(),init()});var stateData=[];$("#select-state-year").on("change",function(){var t=$("#select-state-year").val(),a=$("#select-state-month").val();update_state_vis(a,t)}),$("#select-state-month").on("change",function(){var t=$("#select-state-year").val(),a=$("#select-state-month").val();update_state_vis(a,t)});