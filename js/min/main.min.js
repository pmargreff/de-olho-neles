function RadarChart(t,a,e){function r(t,a){t.each(function(){for(var t,e=d3.select(this),r=e.text().split(/\s+/).reverse(),n=[],o=0,i=1.4,l=e.attr("y"),s=e.attr("x"),d=parseFloat(e.attr("dy")),c=e.text(null).append("tspan").attr("x",s).attr("y",l).attr("dy",d+"em");t=r.pop();)n.push(t),c.text(n.join(" ")),c.node().getComputedTextLength()>a&&(n.pop(),c.text(n.join(" ")),n=[t],c=e.append("tspan").attr("x",s).attr("y",l).attr("dy",++o*i+d+"em").text(t))})}var n={w:600,h:600,margin:{top:20,right:20,bottom:20,left:20},levels:1,maxValue:0,labelFactor:1.25,wrapWidth:60,opacityArea:.35,dotRadius:4,opacityCircles:.1,strokeWidth:2,roundStrokes:!1,color:d3.scale.category10()};if("undefined"!=typeof e)for(var o in e)"undefined"!=typeof e[o]&&(n[o]=e[o]);a=a.map(function(t){return t.values});var i=Math.max(n.maxValue,d3.max(a,function(t){return d3.max(t.map(function(t){return t.value}))})),l=a[0].map(function(t,a){return t.axis}),s=l.length,d=Math.min(n.w/2,n.h/2),c=d3.format(".0f"),p=2*Math.PI/s,u=d3.scale.linear().range([0,d]).domain([0,i]);d3.select(t).select("svg").remove();var h=d3.select(t).append("svg").attr("width",n.w+n.margin.left+n.margin.right).attr("height",n.h+n.margin.top+n.margin.bottom).attr("class","radar"+t),f=h.append("g").attr("transform","translate("+(n.w/2+n.margin.left)+","+(n.h/2+n.margin.top)+")"),m=f.append("defs").append("filter").attr("id","glow"),g=(m.append("feGaussianBlur").attr("stdDeviation","2.5").attr("result","coloredBlur"),m.append("feMerge")),v=(g.append("feMergeNode").attr("in","coloredBlur"),g.append("feMergeNode").attr("in","SourceGraphic"),f.append("g").attr("class","axisWrapper"));v.selectAll(".levels").data(d3.range(1,n.levels+1).reverse()).enter().append("circle").attr("class","gridCircle").attr("r",function(t,a){return d/n.levels*t}).style("fill","#CDCDCD").style("stroke","#CDCDCD").style("fill-opacity",n.opacityCircles).style("filter","url(#glow)"),v.selectAll(".axisLabel").data(d3.range(1,n.levels+1).reverse()).enter().append("text").attr("class","axisLabel").attr("x",4).attr("y",function(t){return-t*d/n.levels}).attr("dy","0.4em").style("font-size","10px").attr("fill","#737373").text(function(t,a){return c(i*t/n.levels)});var y=v.selectAll(".axis").data(l).enter().append("g").attr("class","axis");y.append("line").attr("x1",0).attr("y1",0).attr("x2",function(t,a){return u(1.1*i)*Math.cos(p*a)}).attr("y2",function(t,a){return u(1.1*i)*Math.sin(p*a)}).attr("class","line").style("stroke","white").style("stroke-width","2px"),y.append("text").attr("class","legend").style("font-size","11px").attr("text-anchor","middle").attr("dy","0.35em").attr("x",function(t,a){return u(i*n.labelFactor)*Math.cos(p*a-Math.PI/2)}).attr("y",function(t,a){return u(i*n.labelFactor)*Math.sin(p*a-Math.PI/2)}).text(function(t){return t}).call(r,n.wrapWidth);var x=d3.svg.line.radial().interpolate("linear-closed").radius(function(t){return u(t.value)}).angle(function(t,a){return a*p});n.roundStrokes&&x.interpolate("cardinal-closed");var b=f.selectAll(".radarWrapper").data(a).enter().append("g").attr("class","radarWrapper");b.append("path").attr("class","radarArea").attr("d",function(t,a){return x(t)}).style("fill",function(t,a){return n.color(a)}).style("fill-opacity",n.opacityArea).on("mouseover",function(t,a){d3.selectAll(".radarArea").transition().duration(200).style("fill-opacity",.1),d3.select(this).transition().duration(200).style("fill-opacity",.7)}).on("mouseout",function(){d3.selectAll(".radarArea").transition().duration(200).style("fill-opacity",n.opacityArea)}),b.append("path").attr("class","radarStroke").attr("d",function(t,a){return x(t)}).style("stroke-width",n.strokeWidth+"px").style("stroke",function(t,a){return n.color(a)}).style("fill","none").style("filter","url(#glow)"),b.selectAll(".radarCircle").data(function(t,a){return t}).enter().append("circle").attr("class","radarCircle").attr("r",n.dotRadius).attr("cx",function(t,a){return u(t.value)*Math.cos(p*a-Math.PI/2)}).attr("cy",function(t,a){return u(t.value)*Math.sin(p*a-Math.PI/2)}).style("fill",function(t,a,e){return n.color(e)}).style("fill-opacity",.8);var w=f.selectAll(".radarCircleWrapper").data(a).enter().append("g").attr("class","radarCircleWrapper");w.selectAll(".radarInvisibleCircle").data(function(t,a){return t}).enter().append("circle").attr("class","radarInvisibleCircle").attr("r",1.5*n.dotRadius).attr("cx",function(t,a){return u(t.value)*Math.cos(p*a-Math.PI/2)}).attr("cy",function(t,a){return u(t.value)*Math.sin(p*a-Math.PI/2)}).style("fill","none").style("pointer-events","all").on("mouseover",function(t,a){newX=parseFloat(d3.select(this).attr("cx"))-10,newY=parseFloat(d3.select(this).attr("cy"))-10,A.attr("x",newX).attr("y",newY).text("R$ "+c(t.value)).transition().duration(200).style("opacity",1)}).on("mouseout",function(){A.transition().duration(200).style("opacity",0)});var A=f.append("text").attr("class","tooltip").style("opacity",0)}function init(t,a,e){d3=d3version4;var r=d3.timeParse("%Y-%m");d3=d3version3,party=a,data=e,a=[];for(var n=0;n<party.length;n++){var o={values:[],key:party[n].party,color:getRandomColor()};a.push(o)}for(var n=0;n<a.length;n++){values=[];for(var i=0;i<data.length;i++)a[n].key==data[i].party&&values.push({x:r(data[i].year+"-"+data[i].month),y:parseInt(parseFloat(data[i].x1))});a[n].values=values}nv.addGraph(function(){return chart=nv.models.lineChart().options({duration:300,useInteractiveGuideline:!0}),chart.xAxis.axisLabel("Date - Year-Month").tickFormat(function(t){return d3.time.format("%Y-%m")(new Date(t))}).staggerLabels(!0),chart.yAxis.axisLabel("Value - R$").tickFormat(function(t){return null==t?"N/A":d3.format(",.2f")(t)}),data=a,d3.select("#party-svg").datum(data).call(chart),nv.utils.windowResize(chart.update),chart})}function getRandomColor(){for(var t="0123456789ABCDEF",a="#",e=0;e<6;e++)a+=t[Math.floor(16*Math.random())];return a}function init(){var t=d3.select("svg"),a={top:20,right:20,bottom:30,left:40},e=+t.attr("width")-a.left-a.right,r=+t.attr("height")-a.top-a.bottom,n=d3.scaleBand().rangeRound([0,e]).padding(.1),o=d3.scaleLinear().rangeRound([r,0]),i=t.append("g").attr("transform","translate("+a.left+","+a.top+")");d3.csv("./data/bystate.csv",function(t){if(stateData.push(t),1==t.month&&2016==t.year)return t.percent=+t.percent,t},function(t,a){if(t)throw t;n.domain(a.map(function(t){return t.state})),o.domain([0,Math.max.apply(Math,stateData.map(function(t){return t.percent}))]),i.append("g").attr("class","axis axis--x").attr("transform","translate(0,"+r+")").call(d3.axisBottom(n)),i.append("g").attr("class","axis axis--y").call(d3.axisLeft(o).ticks(10,"%")).append("text").attr("transform","rotate(-90)").attr("y",6).attr("dy","0.71em").attr("text-anchor","end").text("Frequency"),i.selectAll(".bar").data(a).enter().append("rect").attr("class","bar").attr("x",function(t){return n(t.state)}).attr("y",function(t){return o(t.percent)}).attr("width",n.bandwidth()).attr("height",function(t){return r-o(t.percent)}).on("mouseover",function(t){coordinates=d3.mouse(this),d3.select(".relative").style("left",coordinates[0]+"px").style("top",coordinates[1]-60+"px").select("#info").text(tooltipText(t)),d3.select("#tooltip").classed("hidden",!1)}).on("mouseout",function(){d3.select("#tooltip").classed("hidden",!0)})})}function tooltipText(t){return"Média - R$: "+parseFloat(t.mean).toFixed(0)+" Máximo - R$: "+(t.mean/t.percent).toFixed(0)+" Total - R$: "+parseFloat(t.x1).toFixed(0)+" Deputados ("+t.state+"): "+t.people}function update_state_vis(t,a){data=[];for(var e=0;e<stateData.length;e++)stateData[e].month==t&&stateData[e].year==a&&data.push(stateData[e]);d3.selectAll(".bar").data(data);var r=d3.select("svg"),n={top:20,right:20,bottom:30,left:40},o=+r.attr("width")-n.left-n.right,i=+r.attr("height")-n.top-n.bottom,l=(d3.scaleBand().rangeRound([0,o]).padding(.1),d3.scaleLinear().rangeRound([i,0]));l.domain([0,Math.max.apply(Math,stateData.map(function(t){return t.percent}))]);r.selectAll(".bar").attr("stroke-width",4).transition().duration(300).attr("height",function(t){for(var a=0;a<data.length;a++)if(data[a].state==t.state)return i-l(data[a].percent)}).attr("transform",function(t){for(var a=0;a<data.length;a++)if(data[a].state==t.state)return"translate("+[0,-this.y.baseVal.value+l(data[a].percent)]+")"})}function createData(t,a){newArr=[],index=0;for(var e=0;e<t.length;e++)t[e].year==a&&(subArr=[],subArr.push(parseInt(index/10)),subArr.push(index%10),val=parseInt(parseFloat(t[e].x1)),subArr.push(val),newArr.push(subArr),index++);return newArr}function array_unique(t){for(var a=[],e=0;e<t.length;e++)a.indexOf(t[e])==-1&&a.push(t[e]);return a}function searchPerson(t){for(var a=0;a<person_data.length;a++)if(person_data[a][0].key==t)return person_data[a]}function createStateSelect(t){for(var a=0;a<t.length;a++)$("#statelist").append('<option value="'+t[a]+'">'+t[a]+"</option>");$("select").material_select();var e=$("#statelist").val();createPersonSelect(e)}function createPersonSelect(t){$("#personlist").empty();for(var a=0;a<state_data.length;a++)state_data[a].state==t&&$("#personlist").append('<option value="'+state_data[a].congressperson_name+'">'+state_data[a].congressperson_name+"</option>");$("select").material_select();var e=$("#personlist").val();newData=searchPerson(e),RadarChart(".radarChart",newData,radarChartOptions)}var myApp=angular.module("serenata-de-amor-visualization",["ui.router"]);myApp.config(function(t,a,e){a.otherwise("/"),e.html5Mode({enabled:!1,requireBase:!1,rewriteLinks:!1}),t.state("total",{url:"/total",templateUrl:"partials/total.html"}).state("view1",{url:"/view1",templateUrl:"partials/view1.html"}).state("view2",{url:"/view2",templateUrl:"partials/view2.html"}).state("view3",{url:"/view3",templateUrl:"partials/view3.html"}).state("party",{url:"/party",templateUrl:"partials/party.html"}).state("about",{url:"/",templateUrl:"partials/about.html"})}),d3=d3version4,d3.queue().defer(d3.csv,"/data/parties.csv").defer(d3.csv,"/data/byparty.csv").await(init);var svg=d3.select("svg"),margin={top:20,right:20,bottom:30,left:50},width=+svg.attr("width")-margin.left-margin.right,height=+svg.attr("height")-margin.top-margin.bottom,g=svg.append("g").attr("transform","translate("+margin.left+","+margin.top+")"),parseTime=d3.timeParse("%Y-%m"),x=d3.scaleTime().rangeRound([0,width]),y=d3.scaleLinear().rangeRound([height,0]),line=d3.line().x(function(t){return x(t.date)}).y(function(t){return y(t.x1)});d3.csv("./data/totalbytime.csv",function(t){return t.date=parseTime(t.date),t.x1=+t.x1,t},function(t,a){if(t)throw t;x.domain(d3.extent(a,function(t){return t.date})),y.domain(d3.extent(a,function(t){return t.x1})),g.append("g").attr("class","axis axis--x").attr("transform","translate(0,"+height+")").call(d3.axisBottom(x)),g.append("g").attr("class","axis axis--y").call(d3.axisLeft(y).ticks(4).tickFormat(d3.formatPrefix(".0",1e7))).append("text").attr("fill","#000").attr("transform","rotate(-90)").attr("y",6).attr("dy","0.71em").style("text-anchor","end").text("Valor - R$"),g.append("path").datum(a).attr("class","line").attr("d",line)}),$(document).ready(function(){$("select").material_select(),init()});var stateData=[];$("#select-state-year").on("change",function(){var t=$("#select-state-year").val(),a=$("#select-state-month").val();update_state_vis(a,t)}),$("#select-state-month").on("change",function(){var t=$("#select-state-year").val(),a=$("#select-state-month").val();update_state_vis(a,t)}),$(document).ready(function(){$("select").material_select()});var globalData,globalOptions,globalChart,newArr;d3.csv("/data/bycompany.csv",function(t){$(function(){globalData=t,normalizedData=createData(t,2016);var a={chart:{type:"heatmap",marginTop:40,marginBottom:80,plotBorderWidth:1,renderTo:"container"},title:{text:""},xAxis:{categories:["","","","","","","","","",""]},yAxis:{categories:["","","","","","","","","",""],title:null},colorAxis:{min:0,minColor:"#e3f2fd",maxColor:"#2196f3"},legend:{align:"right",layout:"vertical",margin:0,verticalAlign:"top",y:25,symbolHeight:280},tooltip:{formatter:function(){return"<b> EMPRESA: <b>"+t[this.point.index].supplier+"</b> <br><b>CNPJ/CPF: <b>"+t[this.point.index].cnpj_cpf+"</b> <br><b>Valor: R$ <b>"+this.point.value.toFixed(0)+"</b> <br><b>Posição (Anual): <b> "+(this.series.data.length-this.point.index)+"</b>º<br>"}},series:[{name:"Valor por empresa",borderWidth:1,borderColor:"#FFFFFF",data:normalizedData,dataLabels:{enabled:!0,color:"#000000"}}]};globalOptions=a;var e=new Highcharts.Chart(a);globalChart=e})}),$("#list").on("change",function(){var t=$("#list").val();newData=createData(globalData,t),globalOptions.series=[{name:"Valor por empresa",borderWidth:1,borderColor:"#FFFFFF",data:newData,dataLabels:{enabled:!0,color:"#000000"}}];new Highcharts.Chart(globalOptions)});var person_data,state_data,margin={top:100,right:100,bottom:100,left:100},width=Math.min(700,window.innerWidth-10)-margin.left-margin.right,height=Math.min(width,window.innerHeight-margin.top-margin.bottom-20),color=d3.scale.ordinal().range(["#00A0B0"]),radarChartOptions={w:width,h:height,margin:margin,maxValue:.5,levels:5,roundStrokes:!0,color:color};d3.json("./data/bypersonandsubquota.json",function(t,a){person_data=a,d3.csv("./data/bypersonandstate.csv",function(t,a){state_data=a,states=array_unique(a.map(function(t){return t.state})),createStateSelect(states)})}),$("#statelist").on("change",function(){var t=$("#statelist").val();createPersonSelect(t)}),$("#personlist").on("change",function(){var t=$("#personlist").val();newData=searchPerson(t),RadarChart(".radarChart",newData,radarChartOptions)}),$(document).ready(function(){$("select").material_select()});